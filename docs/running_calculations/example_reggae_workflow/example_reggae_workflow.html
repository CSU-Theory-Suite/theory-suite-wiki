<!DOCTYPE html>
<html class="writer-html5" lang="python" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Example REGGAE Workflow &mdash; csu-wiki  documentation</title><link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Example Descriptors Workflow using RDKit, Modred, Morfeus &amp; DBStep" href="../example_descriptors_workflow/example_descriptors_workflow.html" />
    <link rel="prev" title="Example GoodVibes Workflow" href="../example_goodvibes_workflow/example_goodvibes_workflow.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            csu-wiki
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Computing Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../computing_resources/paton_computing_resources.html">Paton Lab Computing Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../computing_resources/kim_computing_resources.html">Kim Lab Computing Resources</a></li>
</ul>
<p class="caption"><span class="caption-text">Helpful Packages</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../helpful_packages/inhouse.html">In-house</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../helpful_packages/external.html">External</a></li>
</ul>
<p class="caption"><span class="caption-text">Graphical Software</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../graphical_software/edition_generation.html">Edition/Generation</a></li>
</ul>
<p class="caption"><span class="caption-text">Running Calculations</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../example_aqme_workflow/example_aqme_workflow.html">Example Workflow in ACME</a></li>
<li class="toctree-l1"><a class="reference internal" href="../example_goodvibes_workflow/example_goodvibes_workflow.html">Example GoodVibes Workflow</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Example REGGAE Workflow</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-1-performing-a-multivariate-regression">Example 1: Performing a multivariate regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-2-performing-a-multivariate-regression">Example 2: Performing a multivariate regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="#regression-plot-generated">Regression Plot Generated</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pearson-correlation-plot">Pearson Correlation Plot</a></li>
<li class="toctree-l2"><a class="reference internal" href="#diagnostics-plot">Diagnostics Plot</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pca-plot">PCA Plot</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../example_descriptors_workflow/example_descriptors_workflow.html">Example Descriptors Workflow using RDKit, Modred, Morfeus &amp; DBStep</a></li>
<li class="toctree-l1"><a class="reference internal" href="../example_censo_workflow/example_censo_workflow.html">Example CENSO Workflow for ACME</a></li>
<li class="toctree-l1"><a class="reference internal" href="../example_nciplot_calculation/example_nciplot_calculation.html">Example NCIPLOT Calculation</a></li>
</ul>
<p class="caption"><span class="caption-text">Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/classical_molecular_dynamics/classical_molecular_dynamics.html">Classical Molecular Dynamics</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">csu-wiki</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Example REGGAE Workflow</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/running_calculations/example_reggae_workflow/example_reggae_workflow.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="example-reggae-workflow">
<h1>Example REGGAE Workflow<a class="headerlink" href="#example-reggae-workflow" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#installation" id="id1">Installation</a></p></li>
<li><p><a class="reference internal" href="#example-1-performing-a-multivariate-regression" id="id2">Example 1: Performing a multivariate regression</a></p></li>
<li><p><a class="reference internal" href="#example-2-performing-a-multivariate-regression" id="id3">Example 2: Performing a multivariate regression</a></p></li>
<li><p><a class="reference internal" href="#regression-plot-generated" id="id4">Regression Plot Generated</a></p></li>
<li><p><a class="reference internal" href="#pearson-correlation-plot" id="id5">Pearson Correlation Plot</a></p></li>
<li><p><a class="reference internal" href="#diagnostics-plot" id="id6">Diagnostics Plot</a></p></li>
<li><p><a class="reference internal" href="#pca-plot" id="id7">PCA Plot</a></p></li>
</ul>
</div>
<div class="section" id="installation">
<h2><a class="toc-backref" href="#id1">Installation</a><a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p>Clone REGGAE from GitHub. Here is the <a class="reference external" href="https://github.com/Liliana-Gallegos/REGGAE/">REGGAE GitHub Page</a></p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/Liliana-Gallegos/REGGAE.git
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Create a new conda environment with all the r-essentials conda packages built from CRAN:</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>conda create -n r_env r-essentials r-base
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Activate the r_env:</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>conda activate r_env
</pre></div>
</div>
<p>Note: To list the r packages already installed in r_env use <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">list</span></code></p>
<ol class="arabic simple" start="4">
<li><p>Install all packages required for REGGAE with conda:</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>conda install --yes --file requirements.txt
</pre></div>
</div>
<p>Note: Maybe need to install using older version of python. Add <code class="docutils literal notranslate"><span class="pre">python=3.9</span></code></p>
<ol class="arabic simple" start="5">
<li><p>Confirm by running REGGAE help options:</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>Rscript reggae.r -h
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>With error: could not find function &quot;all_of&quot;, then run setup_for_allof.r script
using <code class="docutils literal notranslate"><span class="pre">Rscript</span> <span class="pre">setup_for_allof.r</span></code></p>
</div>
</div>
<div class="section" id="example-1-performing-a-multivariate-regression">
<h2><a class="toc-backref" href="#id2">Example 1: Performing a multivariate regression</a><a class="headerlink" href="#example-1-performing-a-multivariate-regression" title="Permalink to this headline">¶</a></h2>
<p>Using (i) Forward-stepwise feature selection and (ii) Random 70 Train and 30 Test split on a
dataset containg 20 samples and 17 features.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>Rscript reggae.r -i 20solvents.csv -y Exp_dG -m stepwise -r <span class="m">0</span>.7
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Other feature selection <code class="docutils literal notranslate"><span class="pre">-m</span></code> options are available.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Dredge option takes time and therefore should be executed with small number of features.</p>
</div>
<p>First portion of the Terminal output (without using the verbose option) includes the split performed,
regression formula in both scaled and nonscaled versions, and the R2 and RMSE values.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>***** RESULTS PROVIDED BY REGGAE *****

o Using Random Sampling for &quot;Train&quot; Samples:  70 %
  Total Number of Training Samples:  14 
  Total Number of Testing Samples:  6 
  Total Number of Variables (including response):  18 


o Forward Step-wise features selected for linear regression:  
  Number of features (including response):  4 

 a) scaled coefficients:
  y =  0.69  +  0.52 * gamma + 0.33 * area + -0.31 * n  

 b) unscaled:
  y = 3.82 + 0.07 * gamma + 0.01 * area + -4.92 * n

  R2-train=  0.68 
  adj R2-train =  0.59 
  RMSE-train =  0.25
</pre></div>
</div>
</div>
<div class="section" id="example-2-performing-a-multivariate-regression">
<h2><a class="toc-backref" href="#id3">Example 2: Performing a multivariate regression</a><a class="headerlink" href="#example-2-performing-a-multivariate-regression" title="Permalink to this headline">¶</a></h2>
<p>Using (i) manual feature selection, (ii) predefined split selection, and (iii) cross-validation.
The split has been defined as Train and Test within the 12kclusters column in the dataset.
Therefore, the script will pick up the column with two catagorical variables.
To execute this option, <code class="docutils literal notranslate"><span class="pre">-r</span></code> is set to 0.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>Rscript reggae.r -i 20solvents.csv -y Exp_dG -b Sig2,V -r <span class="m">0</span> -q -v
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Error can occur if there are multiple columns with strings or characters.</p>
</div>
<p>First portion of the Terminal output (without using the verbose option) includes the split performed,
regression formula in both scaled and nonscaled versions, R2 and RMSE values,
and three cross validation analysis: Leave-one-out, K-fold (k=5), and Q2.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>***** RESULTS PROVIDED BY REGGAE *****

o Using data option with pre-defined Test/Train split. 
 Labels:   TEST TRAIN 

o Using Pre-selected &quot;Train&quot; Samples:  60 %
  Total Number of Training Samples:  12 
  Total Number of Testing Samples:  8 
  Total Number of Variables (including response):  19 


o Linear regression model with SELECTED features:  
  Number of features (including response):  3 

 a) scaled coefficients:
  y =  0.888  +  0.533 * Sig2 + 0.400 * V  

 b) unscaled:
  y = -1.13 + 0.03 * Sig2 + 1.09 * V

  R2-train =  0.67 
  adj R2-train =  0.6 
  RMSE-train =  0.29 


o Cross Validation for model ( k =  5 ): 
  LOO-q2 (train) =  0.5 
  Iteration  1 : Kfold-q2 =  0.55 
  Iteration  2 : Kfold-q2 =  0.61 
  Iteration  3 : Kfold-q2 =  0.39 
  Iteration  4 : Kfold-q2 =  0.42 
  Iteration  5 : Kfold-q2 =  0.55 
  Avg Kfold-q2 (train) =  0.5 ( +/- 0.09 )
  RMSE =  0.38 
  q2 (test) =  0.76 
  RMSE-test =  0.22 
</pre></div>
</div>
<p>Using the <code class="docutils literal notranslate"><span class="pre">-v</span></code> option prints out the following Terminal output: preview of the scaled values,
ANOVA analysis, regression plot (.png), a table of predicted y-values.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>********** DETAILED RESULTS **********

o Dataset preview ( y = Exp_dG )
                 y       Sig2           V
dodecane      1.46 -1.2475538  2.37937801
quinoline     1.30  0.4318541  0.32214382
acetonitrile  0.67  0.4561040 -1.42177832
dioxane       0.75  0.5822035 -0.66764982
anisole       1.24 -0.1016439 -0.02740345

o Linear Regression model with SELECTED features: 

Call:
lm(formula = y ~ ., data = data)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.68843 -0.18283  0.02388  0.23091  0.41676 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.88833    0.09526   9.325 6.38e-06 ***
Sig2         0.53260    0.12580   4.234  0.00219 ** 
V            0.39982    0.12580   3.178  0.01122 *  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.33 on 9 degrees of freedom
Multiple R-squared:  0.6724,	Adjusted R-squared:  0.5996 
F-statistic: 9.238 on 2 and 9 DF,  p-value: 0.006589


o Regression plot(s) saved in working file. 

o Predicted y-values: 
                  Y Pred_Y Split
cyclohexane   -0.06  -0.05 Train
toluene        0.03   0.42  Test
xylenes        0.24   0.59  Test
chlorobenzene  0.25   0.44 Train
dibutyl ether  0.33   1.02 Train
DCB            0.46   0.57  Test
THF            0.56   0.37  Test
acetonitrile   0.67   0.56 Train
dioxane        0.75   0.93 Train
nitrobenzene   0.82   1.07 Train
pyridine       0.85   0.69  Test
tetralin       0.86   0.77  Test
benzonitrile   0.97   1.04  Test
mesitylene     0.98   0.75 Train
anisole        1.24   0.82 Train
NMP            1.24   1.40  Test
quinoline      1.30   1.25 Train
DMF            1.36   1.13 Train
dodecane       1.46   1.18 Train
DMSO           1.56   1.57 Train
...
</pre></div>
</div>
<p>Continued Terminal output includes analysis for the three cross-validation methods.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>o I. Leave-one-out Cross validation: 

---- CALL ----
looq2(modelData = data_train, formula = formula)

---- RESULTS ----

-- MODEL CALIBRATION (linear regression)
#Elements: 	12

mean (observed): 	0.8883
mean (predicted): 	0.8883
rmse (nu = 0): 		0.2858
r^2: 			0.6724

-- PREDICTION PERFORMANCE (cross validation)
#Runs: 				1
#Groups: 			12
#Elements Training Set: 	11
#Elements Test Set: 		1

mean (observed): 	0.8883
mean (predicted): 	0.8589
rmse (nu = 1): 		0.4018
q^2: 			0.5014

o II. K-fold Cross validation ( k = 5 ): 

---- CALL ----
cvq2(modelData = data_train, formula = formula, nFold = K)

---- RESULTS ----

-- MODEL CALIBRATION (linear regression)
#Elements: 	12

mean (observed): 	0.8883
mean (predicted): 	0.8883
rmse (nu = 0): 		0.2858
r^2: 			0.6724

-- PREDICTION PERFORMANCE (cross validation)
#Runs: 				1
#Groups: 			5
#Elements Training Set: 	9 (+1)
#Elements Test Set: 		3 (-1)

mean (observed): 	0.8883
mean (predicted): 	0.8837
rmse (nu = 1): 		0.3816
q^2: 			0.5530

o III. Test set validation: 

---- CALL ----
q2(modelData = data_train, predictData = data_test, formula = formula)

---- RESULTS ----

-- MODEL CALIBRATION (linear regression)
#Elements: 	12

mean (observed): 	0.8883
mean (predicted): 	0.8883
rmse (nu = 0): 		0.2858
r^2: 			0.6724

-- PREDICTION PERFORMANCE (model and prediction set available)
#Elements Model Set: 		12
#Elements Prediction Set: 	8

mean (observed): 	0.6512
mean (predicted): 	0.7306
rmse (nu = 0): 		0.2181
q^2: 			0.7592
******************END*****************
</pre></div>
</div>
</div>
<div class="section" id="regression-plot-generated">
<h2><a class="toc-backref" href="#id4">Regression Plot Generated</a><a class="headerlink" href="#regression-plot-generated" title="Permalink to this headline">¶</a></h2>
<p>From Example2: Regression plot is saved in working folder as REGGAE-MV-linear-plot.png.</p>
<p class="centered">
<strong><img alt="REGGAE-MV-linear-plot" src="../../_images/REGGAE-MV-linear-plot.png" /></strong></p></div>
<div class="section" id="pearson-correlation-plot">
<h2><a class="toc-backref" href="#id5">Pearson Correlation Plot</a><a class="headerlink" href="#pearson-correlation-plot" title="Permalink to this headline">¶</a></h2>
<p>Adding the <code class="docutils literal notranslate"><span class="pre">-c</span> <span class="pre">0.5</span></code> option outputs: pairwise correlations between features &gt; 0.5</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>********** DETAILED RESULTS **********
...
o Correlation table for all variables: 
        y  Sig2     V
y    1.00  0.55  0.14
Sig2 0.55  1.00 -0.61
V    0.14 -0.61  1.00

o Correlation plot saved in working file. 
</pre></div>
</div>
<p>Using the <code class="docutils literal notranslate"><span class="pre">-v</span></code> option saves the plot within the working folder as REGGAE-correlation-plot.png.</p>
<p class="centered">
<strong><img alt="REGGAE-correlation-plot" src="../../_images/REGGAE-correlation-plot.png" /></strong></p></div>
<div class="section" id="diagnostics-plot">
<h2><a class="toc-backref" href="#id6">Diagnostics Plot</a><a class="headerlink" href="#diagnostics-plot" title="Permalink to this headline">¶</a></h2>
<p>Adding the <code class="docutils literal notranslate"><span class="pre">-d</span></code> option outputs: QSAR analysis for the Test set and collinearity analysis in the first section (withou <code class="docutils literal notranslate"><span class="pre">-v</span></code> option).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>o Diagnostic results:
I. Reduced model significance:  
  F-value full =  9.238 
  F-value reduced =  9.238 

II. QSAR model criteria for Test data set:
  Satisfactory conditions include: 
  R2-test &gt; 0.6; R2-diff &lt; 0.1; 0.85 &lt;= k &lt;= 1.15 or 0.85 &lt;= k&#39;&lt;= 1.15; 
 
  R2 =  0.708 
  k =  0.91 
  k&#39; =  1.02 
  R2-diff (actual) =  -0.342 
  R2-diff (pred) =  -0.41 

IV. Collinearity diagnostics for reduced model: 
  Note: VIF &gt; 4 or 10 indicates collinearity.
  Variables with collinearity: 


  No collinearity found within model. VIF &lt; 4 
</pre></div>
</div>
<p>Using the <code class="docutils literal notranslate"><span class="pre">-v</span></code> option saves the plot within the working folder as REGGAE-diagnostics-plot.png.</p>
<p class="centered">
<strong><img alt="REGGAE-diagnostics-plot" src="../../_images/REGGAE-diagnostics-plot.png" /></strong></p></div>
<div class="section" id="pca-plot">
<h2><a class="toc-backref" href="#id7">PCA Plot</a><a class="headerlink" href="#pca-plot" title="Permalink to this headline">¶</a></h2>
<p>Using the <code class="docutils literal notranslate"><span class="pre">-p</span> <span class="pre">5,2</span></code> option requests running principal componenet analysis with k-means clustering using 5 clusters and 2 components.
Using the <code class="docutils literal notranslate"><span class="pre">-v</span></code> option gives the PCA-clusters and Scree plots (or elbow plots) for each the clusters and components.
Also, within the terminal output, the script returns the loadings.
Showing only the PCA clustering plot.</p>
<p class="centered">
<strong><img alt="PCA-clusters-REGGAE" src="../../_images/PCA-clusters-REGGAE.png" /></strong></p></div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../example_goodvibes_workflow/example_goodvibes_workflow.html" class="btn btn-neutral float-left" title="Example GoodVibes Workflow" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../example_descriptors_workflow/example_descriptors_workflow.html" class="btn btn-neutral float-right" title="Example Descriptors Workflow using RDKit, Modred, Morfeus &amp; DBStep" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, csu-theory-suite.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>